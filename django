#!/bin/bash

# Ensure correct usage
if [ "$#" -ne 2 ]; then
    echo "Usage: ./django <create|delete|run> <project_name>"
    exit 1
fi

COMMAND=$1
PROJECT_NAME=$2
DPM_NAME=django_project_mgmt.py
DPM_DIR=./automate/bin
DPM_EXE=$DPM_DIR/$DPM_NAME
PYTHON_EXE=python
PROJECT_PATH="env/dev/$PROJECT_NAME"

# Validate commands
if [[ "$COMMAND" != "create" && "$COMMAND" != "delete" && "$COMMAND" != "run" ]]; then
    echo "Invalid command: $COMMAND"
    echo "Usage: ./django <create|delete|run> <project_name>"
    exit 1
fi

if [ "$COMMAND" == "create" ]; then
    $PYTHON_EXE $DPM_EXE create "$PROJECT_NAME"

    # If creation succeeds, create the 'm3' shortcut script inside the project directory
    if [ $? -eq 0 ]; then
        echo -e "#!/bin/bash\npython manage.py runserver" > "$PROJECT_PATH/m3"
        chmod +x "$PROJECT_PATH/m3"
        echo "Shortcut 'm3' created in $PROJECT_PATH"
    fi
fi

if [ "$COMMAND" == "delete" ]; then
    $PYTHON_EXE $DPM_EXE delete "$PROJECT_NAME"
fi

if [ "$COMMAND" == "run" ]; then
    if [ ! -d "$PROJECT_PATH" ]; then
        echo "Error: Django project '$PROJECT_NAME' does not exist."
        exit 1
    fi

    if [ ! -f "$PROJECT_PATH/m3" ]; then
        echo "Error: Shortcut 'm3' not found in $PROJECT_PATH"
        exit 1
    fi

    # Change directory and run the shortcut script
    cd "$PROJECT_PATH"
    ./m3
fi
